<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Hiro + Kanji Marker Popup</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin:0; overflow:hidden; font-family:sans-serif; }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 800px;
      background: #000;
      border-radius: 8px;
      display: none;
      z-index: 100;
      padding: 0;
    }

    .closeBtn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: red;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
      z-index: 101;
    }

    iframe {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 0 0 8px 8px;
    }

    img {
      width: 100%;
      height: auto;
      border-radius: 0 0 8px 8px;
      display: block;
    }
  </style>
</head>
<body>

  <!-- YouTube 影片視窗 -->
  <div id="videoPopup" class="popup">
    <button class="closeBtn" onclick="closeVideo()">關閉</button>
    <iframe id="ytPlayer" 
            src="" 
            allow="autoplay; encrypted-media" allowfullscreen>
    </iframe>
  </div>

  <!-- 圖片視窗 -->
  <div id="imagePopup" class="popup">
    <button class="closeBtn" onclick="closePopup('imagePopup')">關閉</button>
    <img src="assets/test.jpg" alt="Test Image">
  </div>

  <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
    <a-marker preset="hiro" id="hiroMarker"></a-marker>
    <a-marker preset="kanji" id="kanjiMarker"></a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const videoPopup = document.getElementById('videoPopup');
    const ytPlayer = document.getElementById('ytPlayer');
    const imagePopup = document.getElementById('imagePopup');
    const hiroMarker = document.getElementById('hiroMarker');
    const kanjiMarker = document.getElementById('kanjiMarker');

    // 檢查是否已有 popup 顯示
    function isAnyPopupVisible() {
      return videoPopup.style.display === 'block' || imagePopup.style.display === 'block';
    }

    // 照到 HIRO marker → 顯示影片
    hiroMarker.addEventListener('markerFound', () => {
      if (!isAnyPopupVisible()) {
        ytPlayer.src = "https://www.youtube.com/embed/cci1yhDeOjs?autoplay=1"; // 設定 src
        videoPopup.style.display = 'block';
      }
    });

    // 照到 Kanji marker → 顯示圖片
    kanjiMarker.addEventListener('markerFound', () => {
      if (!isAnyPopupVisible()) {
        imagePopup.style.display = 'block';
      }
    });

    // 關閉影片：隱藏視窗 + 停止播放
    function closeVideo() {
      videoPopup.style.display = 'none';
      ytPlayer.src = ""; // 清空 src 停止影片
    }

    // 關閉圖片
    function closePopup(id) {
      document.getElementById(id).style.display = 'none';
    }
  </script>

</body>
</html>
